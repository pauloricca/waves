exp:
  tempo:
    bpm: 120
    signal:
      expression:
        exp: kick * kick_amp + hat * hat_amp + synth * synth_amp
        kick_amp:
          midi_cc:
            cc: 0
        kick:
          sequencer:
            id: kick-drum
            interval: sixteenth
            repeat: 1000
            steps:
              - kick
              - 
              - hihat v.0
              - 
              - kick
              - 
              - hihat v.0
              -
              - kick
              - 
              - hihat v.0
              -
              - kick
              - 
              - hihat v.0
              -
              - kick
              - 
              - hihat v.0
              - 
              - kick
              - 
              - hihat v.0
              -
              - kick
              - 
              - hihat v.0
              -
              - kick
              - hihat v.05
              - hihat v.0
              -
        hat_amp:
          midi_cc:
            cc: 1
        hat:
          sequencer:
            interval: sixteenth
            repeat: 1000
            steps:
              -
              - 
              - # hihat v.2
              - 
              - 
              - chop c2
              - 
              - 
              -
              - 
              - hihat v.2
              - chop
              - 
              - 
        synth_amp:
          midi_cc:
            cc: 2
        synth:
          expression:
            exp: signal * duck
            duck:
              follow:
                attack: 0.002
                release: 0.02
                signal:
                  reference:
                    ref: kick-drum
            signal:
              retrigger:
                repeat: 5
                time: 0.3
                feedback: 0.5
                signal:
                  osc:
                    type: sin
                    freq:
                      expression:
                        exp: base * multiplier
                        multiplier:
                          automation:
                            interval: sixteenth
                            repeat: 1000
                            steps: [1, 1, 1, 1, 4, 2, 1, 1, 8, 1, 1.2, 1, 1.2, 1, 1, 1]
                        base:
                          snap:
                            values: [c1, c2, c3, c4]
                            glide: 1
                            signal:
                              midi_cc:
                                initial: 30
                                cc: 16
                                range: [30, 260]
                    phase:
                      osc:
                        type: tri
                        amp:
                          expression:
                            exp: auto * multiplier
                            multiplier:
                              midi_cc:
                                initial: 0
                                cc: 17
                                range: [0, 1]
                            auto:
                              automation:
                                interval: triplet * 3
                                repeat: 1000
                                steps: [0, 0.1, 0, 0.4, 0.1, 0.6, 1, 0, 0, 0.1]
                        freq: 
                          snap:
                            values: [c0, c1, c2, c3]
                            glide: 2
                            signal:
                              midi_cc:
                                initial: 30
                                cc: 18
                                range: [0, 160]
    


synth2:
  tempo:
    bpm: 130
    signal:
      expression:
        exp: signal
        signal:
          retrigger:
            repeat: 3
            time: 0.3
            feedback: 0.2
            signal:
              osc:
                amp:
                  midi_cc:
                    cc: 2
                type: sin
                freq:
                  expression:
                    exp: base * multiplier * fm
                    multiplier:
                      automation:
                        interval: sixteenth
                        repeat: 1000
                        steps: [1, 1, 1, 1, 4, 2, 1, 1, 8, 1, 1.2, 1, 1.2, 1, 1, 1, 1, 1, 1, 1, 1]
                    base:
                      snap:
                        values: [c1, c2, c3, c4]
                        glide: 1
                        signal:
                          midi_cc:
                            initial: 30
                            cc: 16
                            range: [30, 260]
                    fm:
                      osc:
                        range: [0, 2]
                        amp:
                          expression:
                            exp: auto * multiplier
                            # exp: multiplier
                            multiplier:
                              midi_cc:
                                initial: 0
                                cc: 17
                                range: [0, 1]
                            auto:
                              automation:
                                interval: triplet
                                repeat: 1000
                                # steps: [0, 0.1, 0, 0.4, 0.1, 0.6, 1, 0, 0, 0.1]
                                steps: [0, 0.1, 0, 0.4, 0, 0.6, 0, 0.1, 0, 0.1]
                        freq: 
                          snap:
                            values: [c0, c1, c2, c3]
                            glide: 2
                            signal:
                              midi_cc:
                                initial: 30
                                cc: 18
                                range: [0, 20000]

# Test the multiply node with a simple chorus effect
test_multiply:
  tempo:
    bpm: 120
    signal:
      multiply:
        number: 5
        signal:
          osc:
            type: sin
            freq: "440 * (1 + i * 0.01)"  # Slightly detune each copy
            phase: "i / n"                 # Distribute phases evenly
            amp: "0.2 / n"                 # Normalize amplitude

# Test harmonic stack using multiply
test_harmonics:
  tempo:
    bpm: 120
    signal:
      multiply:
        number: 8
        signal:
          osc:
            type: sin
            freq: "220 * (i + 1)"  # Create harmonics (220, 440, 660, ...)
            amp: "0.3 / (i + 1)"   # Reduce amplitude for higher harmonics

# Advanced test: Multiply with envelopes and varying parameters
test_multiply_advanced:
  tempo:
    bpm: 120
    signal:
      multiply:
        number: 10
        signal:
          expression:
            exp: "osc"
            osc:
              osc:
                type: saw
                freq: "50 * (1 + i * 0.0001)"  # Spread frequencies
                phase: "i / n"                 # Phase spread



synth3:
  multiply:
    number: 8
    signal:
      osc:
        type: sin
        freq: 
          midi_cc:
            range: [0, 2000]
            cc: 15 + i
            initial: 0
        phase: "(i-1) / n"
        amp:
          midi_cc:
            cc: i - 1
            initial: 0



hum:
  # retrigger:
  #   repeat: 3
  #   time: 0.3
  #   feedback: 0.2
  #   signal:
      expression:
        exp: amp * amp2 * signal * 0.3
        amp:
          osc:
            type: tri
            freq: 1
            range: [0.2, 1]
        amp2:
          osc:
            type: tri
            freq: 2
            range: [0.6, 1]
        signal:
          multiply:
            number: 8
            signal:
              expression:
                exp: amp * signal
                amp:
                  midi_cc:
                    cc: i - 1
                    initial: 0
                signal:
                  sample:
                    file: samples/hum.wav
                    start: 0.2
                    end: 0.5
                    loop: true
                    # base_freq: 200
                    base_freq:
                      midi_cc:
                        range: [0, 100]
                        cc: 16
                        initial: 0
                    freq: 
                      midi_cc:
                        range: [0, 300]
                        cc: 15 + i
                        initial: 0
              



seq-glitch:
  tempo:
    bpm: 120
    signal:
      expression:
        exp: 0.4 * perc + pads
        pads:
          retrigger:
            repeat: 3
            time: 0.3
            feedback: 0.2
            signal:
              expression:
                exp: amp * signal * 0.3
                amp:
                  automation:
                    mode: overlap
                    overlap: 0.01
                    repeat: 1000
                    interval: sixteenth * 2
                    steps:
                      - 0
                      - .5
                      - 1
                      - 0
                
                      - .5
                      - .7
                      - .2
                      - .5
                signal:
                  multiply:
                    number: 8
                    signal:
                      expression:
                        exp: amp * signal
                        amp:
                          midi_cc:
                            cc: i - 1
                            initial: 0
                        signal:
                          sample:
                            file: samples/hum.wav
                            start: 0.2
                            end: 0.5
                            loop: true
                            base_freq: 200
                            # base_freq:
                            #   midi_cc:
                            #     range: [0, 100]
                            #     cc: 16
                            #     initial: 0
                            freq: 
                              midi_cc:
                                range: [100, 390]
                                cc: 15 + i
                                initial: 0
        perc:
          sequencer:
            interval: sixteenth
            repeat: 1000
            steps:
              - kick
              - 
              - chop c10
              - kick
  
              - glitch
              - hihat
              - chop
              - glitch
    
              -
              - kick
              - chop c3
              -
    
              - glitch
              - kick
              - chop
              -
