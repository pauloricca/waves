# Test context variable chaining (define a, then use a to define b)
test_context_chaining:
  context:
    a: 440
    b: "a * 2"
    c: "b / 4"
    signal:
      osc:
        duration: 2
        freq: c  # Should be 440 * 2 / 4 = 220 Hz

# Test complex context variable chaining with time-based variables
test_context_advanced:
  context:
    base_freq: 220
    lfo_rate: "base_freq / 100"  # 2.2 Hz
    mod_depth: "base_freq / 2"   # 110 Hz depth
    final_freq:
      osc:
        freq: "lfo_rate"         # Uses the calculated LFO rate
        range: ["base_freq - mod_depth", "base_freq + mod_depth"]
    signal:
      osc:
        duration: 4
        freq: final_freq  # Complex modulated frequency

# Test track node with static pan
test_track_node:
  track:
    pan: -0.7  # Pan left
    signal:
      osc:
        type: sin
        freq: 440
        duration: 2

# Test pitch detection node - simple tone
test_pitch_simple:
  pitch:
    duration: 3
    signal:
      osc:
        type: sin
        freq: 440  # Should detect ~440 Hz

# Test pitch detection node - changing frequency
test_pitch_changing:
  mix:
    duration: 3
    signals:
      # Original signal with frequency sweep
      - osc:
          type: sin
          freq: [440, [220, 0.5], 880]  # Sweep from 440 to 220 to 880
      
      # Pitch detection output (sonified by using as oscillator frequency)
      - osc:
          type: saw
          amp: 0.3
          freq:
            pitch:
              smoothing: 0.95  # Heavy smoothing for stability
              signal:
                osc:
                  type: sin
                  freq: [440, [220, 0.5], 880]

# Test pitch detection node - with sample
test_pitch_sample:
  osc:
    duration: 3
    type: sin
    amp: 0.3
    freq:
      pitch:
        min_freq: 60
        max_freq: 2000
        smoothing: 0.9
        signal:
          sample:
            file: samples/waves.wav
            loop: true


voice:
  mix:
    voz:
      track:
        volume: 0
        signal:
          input:
            id: voz
    instrument:
      osc:
        duration: 300
        type: tri
        amp:
          follow:
            signal: $voz * 30
        freq:
          snap:
            values: [A5, B5, C5, D5, E5, F5, G5]
            signal:
              pitch:
                min_freq: 60
                max_freq: 2000
                smoothing: 0.9
                signal: $voz


# Test buffer node - basic offset mode
test_buffer_offset:
  buffer:
    duration: 2
    length: 2
    offset: 0.1  # Read 100ms back from write head
    signal:
      osc:
        type: sin
        freq: 440

# Test buffer node - position mode (like sample)
test_buffer_position:
  buffer:
    duration: 2
    length: 2
    start: 0.0
    end: 0.5
    loop: true
    file: samples/waves.wav

# Test buffer node - named buffer write/read
test_buffer_shared_write:
  buffer:
    duration: 2
    name: A
    length: 2
    offset: 0.2  # Read 200ms back
    signal:
      osc:
        type: sin
        freq: 220

# Test buffer node - speed control
test_buffer_speed:
  mix:
    duration: 20
    # left_pan: -1
    left_vol: 1
    left:
      buffer:
        length: 1
        name: "shared"
        # file: samples/paulo.wav
        speed: 1
        loop: true
        signal:
          expression:
            exp: sample * 0.2 + delayed * 0.9
            sample:
              # input: {}
              sample:
                file: samples/paulo.wav
            delayed:
              buffer:
                name: "shared"
                # start: 0.2
                # end: 0.3
                loop: true
                offset:
                  osc:
                    freq: 4
                    range: [0.2, 0.203]
    right_pan: 1
    right_vol: 0
    right:
      buffer:
        name: "shared"
        start: 0.1
        end: 1
        loop: true
        # offset: 0
        # offset:
        #   osc:
        #     freq: 0.2
        #     range: [1, 0]
        # speed: 0.5

# Test buffer node - multiple readers from same buffer
test_buffer_multi_read:
  mix:
    duration: 2
    signals:
      # Write to buffer "shared"
      - buffer:
          name: shared
          length: 20
          signal:
            osc:
              duration: 0.1
              type: sin
              freq: 440
      # Read from buffer with short offset - needs duration to keep reading
      - buffer:
          name: shared
          offset: 1

# Test pass-through nodes (context/tempo) wrapping tracks
test_pass_through_mix:
  context:
    v: 0.5
    signal:
      mix:
        duration: 2
        left:
          osc:
            type: sin
            freq: 440
            amp: v
        left_pan: -1
        right:
          osc:
            type: sin
            freq: 880
            amp: v
        right_pan: 1

# Test tempo wrapping tracks
test_tempo_mix:
  tempo:
    bpm: 120
    signal:
      mix:
        duration: 2
        kick:
          osc:
            type: sin
            freq: 60
            duration: 0.5
        kick_pan: 0

# Test nested pass-through nodes with tracks
test_nested_pass_through:
  tempo:
    bpm: 140
    signal:
      context:
        v: 0.8
        signal:
          mix:
            duration: 2
            main:
              osc:
                type: sin
                freq: 440
                amp: v
            main_pan: 0


# Test stereo node with dynamic pan (auto-pan)
test_stereo_autopan:
  track:
    pan:
      osc:
        type: sin
        freq: 0.5  # Pan left-right twice per second
        range: [-1, 1]
    signal:
      osc:
        type: sin
        freq: 440
        duration: 4

# Test stereo mix node with track nodes for panning
test_track:
  mix:
    duration: 2
    left:
      track:
        pan: -1
        signal:
          osc:
            type: sin
            freq: 440
    right:
      track:
        pan: 1
        signal:
          osc:
            type: sin
            freq: 880
    center:
      track:
        pan: 0
        signal:
          osc:
            type: sin
            freq: 220

# Test volume and pan control per track
test_volume:
  mix:
    duration: 2
    loud:
      track:
        pan: -1
        volume: 1.0
        signal:
          osc:
            type: sin
            freq: 440
    quiet:
      track:
        pan: 1
        volume: 0.3
        signal:
          osc:
            type: sin
            freq: 880
    dynamic_vol:
      track:
        pan: 0
        signal:
          osc:
            type: sin
            freq: 220
    dynamic_vol_vol:
      osc:
        type: sin
        freq: 2
        range: [0, 1]

# Test stereo retrigger with spread
test_retrigger_track:
  mix:
    duration: 3
    main:
      retrigger:
        time: 0.15
        repeat: 5
        feedback: 0.7
        spread: 1.0
        movement: 0
        signal:
          osc:
            type: sin
            freq: 440
            duration: 0.05

# Test stereo retrigger with movement
test_retrigger_movement:
  mix:
    duration: 6
    main:
      retrigger:
        time: 0.2
        repeat: 6
        feedback: 0.6
        spread: 0.7
        movement: 0.2
        signal:
          osc:
            type: sin
            freq: 220
            duration: 0.1
            attack: 0.01
            release: 0.03

# Test musical stereo retrigger
test_retrigger_musical:
  mix:
    duration: 4
    clicks:
      retrigger:
        time: 0.12
        repeat: 8
        feedback: 0.5
        spread: 1.0
        movement: 0.3
        signal:
          osc:
            type: sin
            freq: 880
            amp: 0.3
            duration: 0.01
    bass:
      retrigger:
        time: 0.24
        repeat: 4
        feedback: 0.7
        spread: 0.6
        movement: 0.15
        signal:
          osc:
            type: tri
            freq: 110
            duration: 0.05
    bass_pan: 0

# Test dynamic panning
test_autopan:
  mix:
    duration: 20
    sound:
      osc:
        type: sin
        amp:
          osc:
            type: sin
            freq: 0.5
            range: [-0.5, 0.5]
        freq: 440
    sound_pan:
      osc:
        type: sin
        freq: 0.6
        range: [-1, 1]
    sound_2:
      osc:
        type: sin
        amp:
          osc:
            type: sin
            freq: 0.4
            range: [-0.5, 0.5]
        freq: 220
    sound_2_pan:
      osc:
        type: sin
        freq: 0.4
        range: [-1, 1]
    sound_3:
      osc:
        type: sin
        amp:
          osc:
            type: sin
            freq: 0.7
            range: [-0.5, 0.5]
        freq: 880
    sound_3_pan:
      osc:
        type: sin
        freq: 0.7
        range: [-1, 1]
    sound_4:
      osc:
        type: sin
        amp:
          osc:
            type: sin
            freq: 0.3
            range: [-0.5, 0.5]
        freq: 110
    sound_4_pan:
      osc:
        type: sin
        freq: 0.3
        range: [-0.5, 0.5]

# Test the input node with simple passthrough
test_input:
  input:
    duration: 50
    amp: 1.0

test_input_phase:
  retrigger:
    repeat: 5
    time: 0.3
    feedback: 0.5
    signal:
      delay:
        mode: tape
        time:
          smooth:
            step: 0.01
            signal:
              midi_cc:
                cc: 16
                range: [1, 2]
              
        signal:
          osc:
            freq:
              midi_cc:
                cc: 17
                range: [10, 800]
            phase:
              osc:
                amp:
                  midi_cc:
                    cc: 18
                    range: [0, 1]
                freq: 
                  midi_cc:
                    cc: 19
                    range: [1, 1000]


# Test input with amplitude modulation
test_input_with_lfo:
  osc:
    # freq: 200
    phase:
      input: {}
    freq:
      follow:
        range: [500, 1]
        signal:
          retrigger:
            repeat: 5
            time: 0.3
            feedback: 0.5
            signal:
              input: {}

# test_select_bool:
#   select:
#     duration: 2
#     test: "1 > 2"
#     "true":
#       osc:
#         type: sin
#         freq: 440
#     "false":
#       osc:
#         type: sin
#         freq: 220

test_select_snap:
  osc:
    freq:
      select:
        duration: 3  # test hot reload
        test:
          snap:
            values: [-1, 0, 1]
            glide: 0.4
            signal:
              osc:
                type: tri
                freq: 1
                range: [-1, 1]
        "-1": 200
        "0": 300
        "1": 500


test_select_fast_switching:
  # Test mid-chunk transitions with fast oscillations
  select:
    duration: 1
    test:
      osc:
        type: sqr
        freq: 20  # Fast switching (20 Hz)
        range: [0, 1]
    "true":
      osc:
        type: sin
        freq: 800
        amp: 0.2
    "false":
      osc:
        type: sin
        freq: 400
        amp: 0.2

loop:
  # osc:
  #   type: tri
  #   duration: 5
  #   freq: 30
  #   phase:
      retrigger:
        time: 0.3
        feedback: 0.5
        repeat: 1
        signal:
        #   mix:
        #     signals:
              envelope:
                  attack: 0.003
                  release: 0.1
                  decay: 0.1
                  sustain: 0
                  gate:
                    osc:
                      freq: 3
                      range: [0, 1]
                      type: sqr
                  signal:
                    # snap:
                    #   interval: 0.01  # Frequency steps
                    #   range: [-1, 1]
                    #   glide: 0.005  # Glide time in seconds
                    #   signal:
                        shuffle:
                          chunks: 500
                          invert: 0.5
                          crossfade: 0.005
                          signal:
                            expression:
                              duration: 50
                              id: sample
                              exp: amp * signal
                              amp: 0.0001
                              amp: 5
                              signal:
                                sample:
                                  file: samples/gregor.wav
                                  speed: [0.2, -0.2, 4, 1, -0.5, 3, 0.2]
                                  loop: true
              # - reference:
              #     ref: sample

synth:
  context:
    freq: 200
    signal:
      mix:
        signals:
          - osc:
              freq: freq
          - osc:
              freq: freq


# MIDI Example - Play sounds via MIDI input
midi-test:
  midi_in:
    channel: 0  # MIDI channel (0-15)
    signal:
      envelope:
        attack: 0.01
        release: 0.3
        end: true  # Signal completion when release is done
        signal:
          osc:
            type: SIN
            amp: 0.5

# MIDI with more complex sound
midi-synth:
  midi_in:
    duration: 9999
    channel: 0
    signal:
      envelope:
        duration: 1
        attack: 0.2
        release: 2.8
        gate: gate
        end: true
        signal:
          expression:
            exp: "signal * 0.1"
            signal:
              mix:
                main:
                  envelope:
                    duration: 0.01
                    signal:
                      expression:
                        exp: "signal * 0.4"
                        signal:
                          mix:
                            signal1:
                              osc:
                                freq: f
                                attack: 0.2
                            signal2:
                              osc:
                                freq: "f * 0.4"
                                amp: 0.5
                                attack: 0.2
                            signal3:
                              osc:
                                freq: "f * 2.2"
                                amp: 0.5
                                attack: 0.2
                            signal4:
                              osc:
                                freq: "f * 2.3"
                                amp: 0.5
                                attack: 0.2
                            signal5:
                              osc:
                                freq: "f * 5"
                                amp: 0.5
                                attack: 0.2

# MIDI with more complex sound
midi-env:
  retrigger:
    time: 0.1
    feedback: 0.5
    repeat: 4
    signal:
      midi_in:
        channel: 0
        signal:
          mix:
            signals:
              - envelope:
                  attack: 0.1
                  decay: 0.1
                  sustain: 0.3
                  release: 1
                  signal:
                    # shuffle:
                    #   seed: 7
                    #   chunks: 32
                    #   signal:
                        sample:
                          # base_freq: 2000
                          # duration: 4
                          base_freq: 200
                          # start: 0.354
                          start: 0
                          # end: 0.5
                          # speed: [0.1, 0.05]
                          # speed: 1
                          loop: true
                          # overlap: 0.5
                          file: samples/paulo.wav
              # - envelope:
              #     attack: 0.1
              #     decay: 0.5
              #     sustain: 0.2
              #     release: 1
              #     signal:
              #       osc:
              #         amp: 0.15
              #         partials:
              #           - osc:
              #               amp: 
              #                 osc:
              #                   freq: 5
              #                   amp: 0.3
              #               duration: 1
              #               release: 0.2
              #               partials:
              #                 - osc:
              #                     freq: 2
              #                     amp: 0.5
              #                 - osc:
              #                     freq: 2.2
              #                     amp: 0.5
              #                 - osc:
              #                     freq: 2.3
              #                     amp: 0.4
              #                 - osc:
              #                     freq: 5
              #                     amp: 0.1
              #           - osc:
              #               freq: 1.5
              #               amp: 0.5
              #           - osc:
              #               freq: 2
              #               amp: 0.2



# MIDI with more complex sound
midi-fm:
      midi_in:
        channel: 0
        signal:
          envelope:
            attack: 0.1
            decay: 0.5
            sustain: 0.8
            release: 1
            signal:
              osc:
                type: sin
                freq: [1, 2]
                  # normalise:
                  #   max: 10
                  #   signal:
                  #     sample:
                  #       # base_freq: 2000
                  #       # duration: 4
                  #       # base_freq: 200
                  #       # start: 0.354
                  #       start: 0.1
                  #       # end: 0.5
                  #       # speed: [0.1, 0.05]
                  #       # speed: 1
                  #       loop: true
                  #       # overlap: 0.5
                  #       file: samples/paulo.wav
                


midi-cc-filter:
  filter:
    type: lowpass
    cutoff:
      midi_cc:
        channel: 0
        cc: 17
        range: [0, 20000]
        initial: 1000
    peak:
      midi_cc:
        channel: 0
        cc: 18
        range: [0, 10]
        initial: 0
    signal:
      osc:
        type: saw
        freq: 
          midi_cc:
            channel: 0
            cc: 16
            range: [20, 2000]
            initial: 0
        amp: 0.3
        attack: 0.01
        release: 0.3


midi-cc-sample:
  sample:
    start:
      midi_cc:
        channel: 0
        cc: 16
        range: [0, 1]
        initial: 0
    end:
      midi_cc:
        channel: 0
        cc: 17
        range: [0, 1]
        initial: 1
    speed:
      midi_cc:
        channel: 0
        cc: 18
        range: [-10, 10]
        initial: 1
    loop: true
    # overlap: 0.5
    file: samples/waves.wav

fm:
  mix:
    signals:
      - osc:
          type: sin
          freq:
            midi_cc:
              channel: 0
              cc: 16
              range: [0, 500]
              initial: 250
          amp:
            midi_cc:
              channel: 0
              cc: 0
              initial: 0.5
          phase:
            osc:
              type: sin
              freq:
                midi_cc:
                  channel: 0
                  cc: 17
                  range: [0, 500]
                  initial: 250
              amp:
                midi_cc:
                  channel: 0
                  cc: 1
                  initial: 0.5
              phase:
                osc:
                  type: sin
                  freq:
                    midi_cc:
                      channel: 0
                      cc: 18
                      range: [0, 500]
                      initial: 250
                  amp:
                    midi_cc:
                      channel: 0
                      cc: 2
                      initial: 0.5
      - osc:
          type: sin
          freq:
            midi_cc:
              channel: 0
              cc: 19
              range: [0, 500]
              initial: 250
          amp:
            midi_cc:
              channel: 0
              cc: 3
              initial: 0.5
          phase:
            osc:
              type: sin
              freq:
                midi_cc:
                  channel: 0
                  cc: 20
                  range: [0, 500]
                  initial: 250
              amp:
                midi_cc:
                  channel: 0
                  cc: 4
                  initial: 0.5
              phase:
                osc:
                  type: sin
                  freq:
                    midi_cc:
                      channel: 0
                      cc: 21
                      range: [0, 500]
                      initial: 250
                  amp:
                    midi_cc:
                      channel: 0
                      cc: 5
                      initial: 0.5
      - osc:
          type: sin
          freq:
            midi_cc:
              channel: 0
              cc: 22
              range: [0, 500]
              initial: 250
          amp:
            midi_cc:
              channel: 0
              cc: 6
              initial: 0.5
          phase:
            sample:
              file: samples/feedback.wav
              speed: 
                midi_cc:
                  channel: 0
                  cc: 23
                  range: [0, 5.0]
                  initial: 1
              loop: true




sample-control:
  sample:
    file: samples/paulo.wav
    loop: true
    start: 0.5
    offset:
      midi_cc:
        channel: 0
        cc: 23
        range: [-1, 1]
        initial: 0
    speed:
      midi_cc:
        channel: 0
        cc: 7
        range: [-2, 2]
        initial: 0


flanger:
  delay:
    time: 0.2
    signal:
      osc:
        type: sin
        freq: 440


# CC 21 wet amp
# CC 22 delay time
# CC 23 sample offset
# CC 4  dry to wet amp
# CC 5  dry amp
# CC 6  feedback amp
# CC 7  sample speed
echo-exp:
  mix:
      # DRY Signal
    dry:
      expression:
        exp: "amp * signal"
        signal:
          sample:
            id: paulo
            file: samples/satanic.wav
            loop: true
            start: 0.5
            offset:
              midi_cc:
                channel: 0
                cc: 23
                range: [-1, 1]
                initial: 0
            speed:
              midi_cc:
                channel: 0
                cc: 7
                range: [-2, 2]
                initial: 1
        amp:
          midi_cc:
            channel: 0
            cc: 5
            range: [0, 1]
            initial: 1
    wet:
      expression:
        exp: "amp * signal"
        amp:
          midi_cc:
            channel: 0
            cc: 21
            range: [0, 1]
            initial: 0
        signal:
          delay: 
            id: echo
            mode: tape
            time: 
              midi_cc:
                channel: 0
                cc: 22
                range: [0, 5]
                initial: 1
            signal:
              mix:
                dry:
                  expression:
                    exp: "max(amp_a, amp_b) * signal"
                    amp_a:
                      midi_cc:
                        channel: 0
                        cc: 4
                        range: [0, 1]
                        initial: 0
                    amp_b:
                      midi_cc:
                        channel: 0
                        cc: 36
                        range: [0, 1]
                        initial: 0
                    signal:
                      reference:
                        ref: paulo
                wet:
                  expression:
                    exp: "amp * signal"
                    amp:
                      midi_cc:
                        channel: 0
                        cc: 6
                        range: [0, 1]
                        initial: 0
                    signal:
                      reference:
                        ref: echo


echo2:
  mix:
    duration: 3
    dry:
      osc:
        id: paulo
        type: sin
        freq: 440
        duration: 0.1
    wet:
      map:
        from: [-1, 1]
        to: [-0.7, 0.7]
        signal:
          delay: 
            id: echo
            time: 0.2
            signal:
              mix:
                dry:
                  reference:
                    ref: paulo
                wet:
                  map:
                    from: [-1, 1]
                    to: [-0.7, 0.7]
                    signal:
                      reference:
                        ref: echo


# Test snap with range and interval
test-snap-range:
  osc:
    duration: 15
    freq:
      snap:
        range: [100, 1000]  # Frequency range
        interval: 100  # Step every 50 Hz: [200, 250, 300, 350, ..., 800]
        glide: 0.3
        signal:
          osc:
            type: perlin
            scale: 10
            range: [200, 800]

# Test snap with dynamic glide time
test-snap-dynamic-glide:
  osc:
    duration: 10
    freq:
      snap:
        values: [100, 200, 400, 800, 1600]
        glide:
          osc:
            freq: 0.5
            range: [0.1, 1.0]  # Glide time varies from 0.1 to 1.0 seconds
        signal:
          osc:
            freq: 0.1
            range: [100, 1600]


# Test envelope retrigger with fast gate
test-envelope-retrigger:
  context:
    gate:
      osc:
        freq: 5  # 5 Hz = retrigger every 0.2 seconds
        range: [0, 1]
    signal:
      envelope:
        attack: 1.0  # 1 second attack, much longer than retrigger period
        decay: 0.1
        sustain: 0.5
        release: 0.5
        gate: gate
        signal:
          osc:
            freq: 440
            amp: 0.3


# Test snap with MIDI CC (if you have a MIDI controller connected)
# This would snap continuous MIDI CC values to specific note frequencies
test-snap-midi_in:
  context:
    gate:
      osc:
        freq: 1
        range: [0, 1]
    signal:
      envelope:
        attack: 0.3
        decay: 0.01
        sustain: 0.3
        release: 0.5
        gate: gate
        signal:
          osc:
            freq:
              snap:
                values: [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25]  # C major scale
                glide: 0.2
                signal:
                  midi_cc:
                    channel: 0
                    cc: 23
                    range: [200, 600]



# Test automation node
test-automation-step:
  osc:
    type: sin
    duration: 5
    freq:
      automation:
        interval: 0.5
        mode: step
        repeat: 2
        steps:
          - 220
          - 
          - 440
          - 
          - 880

test-automation-ramp:
  osc:
    type: sin
    duration: 5
    freq:
      automation:
        interval: 0.5
        mode: ramp
        repeat: 2
        steps:
          - 220
          - 
          - 440
          - 
          - 880

test-automation-overlap:
  osc:
    type: sin
    duration: 5
    freq:
      automation:
        interval: 0.5
        mode: overlap
        overlap: 0.1
        repeat: 2
        steps:
          - 220
          - 
          - 440
          - 
          - 880

test-automation-nodes:
  osc:
    type: sin
    duration: 10
    freq:
      automation:
        interval: 1
        mode: step
        repeat: 1
        steps:
          - 
          -
          -
          - osc:
              type: sin
              freq: 2
              range: [200, 400]
          - 
          - osc:
              type: sin
              freq: 5
              range: [400, 800]

# Test interval node with major pentatonic scale using list
test_interval_pentatonic:
  osc:
    duration: 3
    type: tri
    freq:
      interval:
        root: 220
        note:
          automation:
            interval: 0.3
            mode: step
            steps: [0, 2, 4, 6, 8]
        scale: [0, 2, 4, 7, 9]  # Major pentatonic

# Test $ syntax for node references in expressions
test_dollar_reference:
  mix:
    duration: 2
    lfo:
      # Define an LFO with an id
      osc:
        id: my_lfo
        type: sin
        freq: 2
        range: [200, 800]
    referencing:
      # Use it directly as a WavableValue without quotes
      osc:
        type: saw
        freq: $my_lfo * 0.5  # $ works in string expressions without quotes!

# Test $ syntax with multiple references
test_dollar_multi_reference:
  expression:
    duration: 2
    exp: $lfo1 + $lfo2 * 0.5  # Combine multiple referenced nodes
    lfo1:
      osc:
        id: lfo1
        type: sin
        freq: 3
        range: [0, 1]
    lfo2:
      osc:
        id: lfo2
        type: tri
        freq: 5
        range: [-1, 1]

ring:
  expression:
    exp: pow(carrier * modulator, 0.2)
    carrier:
      osc:
        freq:
          automation:
            interval: 0.1
            steps: [200, 400, 800, 400]
    modulator:
      input: {}

# Test monitor functionality
test_monitor:
  mix:
    id: output
    monitor: true  # Show mixer output
    signals:
      - osc:
          id: lfo
          monitor: true  # Show LFO
          type: sin
          freq: 2
          range: [200, 800]
      - osc:
          id: osc1
          monitor: true  # Show first oscillator
          type: sin
          freq: $lfo
          amp: 0.3
      - osc:
          id: osc2
          monitor: true  # Show second oscillator
          type: saw
          freq: $lfo * 1.5
          amp: 0.2

# Test monitor with sequencer
test_monitor_seq:
  mix:
    id: output
    monitor: true
    duration: 10
    signals:
      - sequencer:
          id: drums
          monitor: true  # Show sequencer with timeline
          interval: 0.125
          repeat: 100
          steps:
            - osc: { type: sin, freq: 200, duration: 0.05, amp: 0.8 }
            - null
            - osc: { type: sin, freq: 400, duration: 0.05, amp: 0.5 }
            - null
            - osc: { type: sin, freq: 200, duration: 0.05, amp: 0.8 }
            - null
            - osc: { type: sin, freq: 400, duration: 0.05, amp: 0.5 }
            - osc: { type: sin, freq: 600, duration: 0.05, amp: 0.3 }
      - osc:
          id: bass
          monitor: true
          type: sin
          freq: 80
          amp: 0.3

# Test glide node with stepped frequency changes
test_glide:
  osc:
    type: sin
    duration: 4
    freq:
      glide:
        time: 0.1  # 300ms glide time
        signal:
          automation:
            interval: 0.5
            mode: step
            repeat: 2
            steps:
              - 220  # A3
              - 330  # E4
              - 440  # A4
              - 550  # C#5

# Test glide with fast changes
test_glide_fast:
  osc:
    type: saw
    duration: 3
    freq:
      glide:
        time: 0.05  # 50ms glide time
        signal:
          automation:
            interval: 0.25
            mode: step
            repeat: 3
            steps:
              - 200
              - 400
              - 300
              - 500

# Test glide with dynamic glide time
test_glide_dynamic_time:
  osc:
    type: sin
    duration: 3
    freq:
      glide:
        time:
          # Slow glide at start, fast at end
          osc:
            type: sin
            freq: 0.5
            range: [0.5, 0.01]
        signal:
          automation:
            interval: 0.5
            mode: step
            repeat: 2
            steps:
              - 220
              - 440
              - 330
              - 550


# Test output
output:
  mix:
    internal:
      track:
        signal:
          input:
            device: l6
            channels: 7
    exrernal:
      track:
        output_device: l6
        output_channels: [1, 2]
        volume: 0.8
        signal:
          osc:
            duration: 999
            freq: 50
            phase:
              osc:
                freq: 150
                range: [0.5, 1]
            amp:
              expression:
                exp: a * b * c
                a:
                  osc:
                    freq: 1
                    amp: [0.8, 1]
                b:
                  osc:
                    freq: 0.65
                    amp: [0.8, 1]
                c:
                  osc:
                    freq: 1.54
                    amp: [0.8, 1]
    exrernal2:
      track:
        output_device: l6
        output_channels: [3, 4]
        volume: 0.8
        signal:
          osc:
            duration: 999
            freq: 75
            phase:
              osc:
                freq: 225
                range: [0.5, 1]
            amp:
              expression:
                exp: a * b * c
                a:
                  osc:
                    freq: 1.1
                    amp: [0.8, 1]
                b:
                  osc:
                    freq: 0.7
                    amp: [0.8, 1]
                c:
                  osc:
                    freq: 1.5
                    amp: [0.8, 1]



# Test glide with zero time (no glide)
test_glide_zero:
  osc:
    type: sin
    duration: 2
    freq:
      glide:
        time: 0  # No glide, instant changes
        signal:
          automation:
            interval: 0.25
            mode: step
            repeat: 2
            steps:
              - 220
              - 440
              - 330
              - 550
